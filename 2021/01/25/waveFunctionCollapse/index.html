<!DOCTYPE html>
<html lang="en">
  <!-- Head tag -->
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Title -->
  
  <title>Wave Function Collapse - Jiayu He</title>

  <!--Favicon-->
  <link rel="icon" href="favicon/favicon.ico">

  <!--Description-->
  
      <meta name="description" content="Wave Function Collapse
I implemented this project in Houdini, inspired by Keijiro&#39;s Wave Function Collapse
.
The &#34;wave function collapse&#34;, or descr">
  

  <!--Author-->
  
      <meta name="author" content="Jiayu He">
  

  <!-- Pure CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css?family=Crimson+Text|Open+Sans:300,800" rel="stylesheet">

  <!-- Custom CSS -->
  
<link rel="stylesheet" href="/css/styles.css">


  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- Google Analytics -->
  

<meta name="generator" content="Hexo 6.3.0"></head>


  <body>
  	<div class="container-fluid navbar-container m-sm-5">
      <!-- Header -->
      <nav class="navbar navbar-toggleable-sm navbar-light px-1 py-3 my-3 mb-sm-5">
  <a class="navbar-brand ml-2" href="/">Jiayu He</a>
  <button class="navbar-toggler navbar-toggler-right py-2" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse text-center" id="navbarCollapse">
    <ul class="navbar-nav ml-auto my-auto">
      
        <li class="nav-item">
          <a class="nav-link" href="/reel">Reel</a>
        </li>
      
        <li class="nav-item">
          <a class="nav-link" href="/about">About</a>
        </li>
      
        <li class="nav-item">
          <a class="nav-link" href="/contact">Contact</a>
        </li>
      
        <li class="nav-item">
          <a class="nav-link" target="_blank" rel="noopener" href="https://www.instagram.com/jiayuhe511/">Instagram</a>
        </li>
      
        <li class="nav-item">
          <a class="nav-link" target="_blank" rel="noopener" href="https://www.linkedin.com/in/jiayu-he-389213145/">LinkedIn</a>
        </li>
      
    </ul>
    <hr class="hidden-md-up" />
  </div>
</nav>


  		<div class="row">
  			<div class="col-lg-4 col-12 pt-3 px-4 pr-lg-5">
  <h1>Wave Function Collapse</h1>
</div>
<div class="col-lg-8 col-12 pt-lg-3 mb-4 pl-lg-5 px-lg-0 px-4 portfolio-content">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/css/lightgallery.min.css" /><div class=".article-gallery"><h1 id="wave-function-collapse">Wave Function Collapse</h1>
<p>I implemented this project in Houdini, inspired by Keijiro's <a
target="_blank" rel="noopener" href="https://github.com/keijiro/WfcMaze">Wave Function Collapse</a>
.</p>
<p>The "wave function collapse", or described as <a
target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Constraint_satisfaction_problem">"Constraints
Satisfaction Problem"</a> in computer science, is a way of problem that
trying to satisfy a system with individual constraints. An example could
be Sudoku Puzzle, which each slots of number has constraints and
influences other slots, and the whole 9x9 slot will shape a form that
satisfy each slots.</p>
<p>This algorithm has a large application in <a
target="_blank" rel="noopener" href="https://robertheaton.com/2018/12/17/wavefunction-collapse-algorithm/">level
design</a> and <a
target="_blank" rel="noopener" href="https://robertheaton.com/2018/12/17/wavefunction-collapse-algorithm/">procedural
generation(by Osckar Stalberg)</a>, Here I try to use 5 most fundamental
module to shape a 3D maze that each slots are connected.</p>
<p>The algorithm consists of two parts.</p>
<ol type="1">
<li><strong>Module Variation</strong></li>
<li><strong>Module Connectivity Encoding</strong></li>
<li><strong>Slots Inference</strong></li>
</ol>
<hr />
<h3 id="module-variation">Module Variation</h3>
<p>We takes the most fundamental modules to shape this maze. We name is
as "L, T, I, S, X" by their connectivity.</p>
<p>Think of them as LEGO Brick, each of them provides corresponding
connectivity (as the blue markers).</p>
<figure>
<a href="image-20230127025251022.png" title="basic modules connectivity" class="gallery-item"><img src="image-20230127025251022.png"
alt="basic modules connectivity" /></a>
<figcaption aria-hidden="true">basic modules connectivity</figcaption>
</figure>
<p>And we can simply connect them attached together to shape a simple
maze.</p>
<p>But we can rotate them also, to create variations. Each varication
actually produces a new connectivity. To make the vairiants, the methos
are</p>
<ol type="1">
<li>if we rotate the module along each of 6 axis(forward, backward, up,
down, left and right) and get one variant.</li>
<li>rotate long the specific axis with another 3 variants, with 90
degree each/</li>
</ol>
<figure>
<a href="image-20230127030419721.png" title="variations" class="gallery-item"><img src="image-20230127030419721.png" alt="variations" /></a>
<figcaption aria-hidden="true">variations</figcaption>
</figure>
<p>The Vex is here: (type means which axis is majored)</p>
<pre class="c+"><code>    if (type == 0 )&#123;//forward majored
        rotate(m0, radians(0), &#123;0,1,0&#125;);//rotate align to front axis(we don&#39;t have to rotate since it is already along with the front axis)
        
        m1 = m0;
        m2 = m0;
        m3 = m0;
        rotate(m1, radians(90), &#123;1,0,0&#125;);
        rotate(m2, radians(180), &#123;1,0,0&#125;);
        rotate(m3, radians(270), &#123;1,0,0&#125;);
        index = 0;
    &#125;
    if(type == 1)&#123;//back majored
        rotate(m0, radians(180), &#123;0,1,0&#125;); //rotate align to back axis
        m1 = m0;
        m2 = m0;
        m3 = m0;
        rotate(m1, radians(90), &#123;-1,0,0&#125;); //rotate along back axis
        rotate(m2, radians(180), &#123;-1,0,0&#125;);
        rotate(m3, radians(270), &#123;-1,0,0&#125;);
        index = 4;
    &#125;
    if(type == 2)&#123; //up majored
        rotate(m0, radians(90), &#123;0,0,1&#125;); // rotate align up axis
        m1 = m0;
        m2 = m0;
        m3 = m0;
        rotate(m1, radians(90), &#123;0,1,0&#125;); //rotate along the up xis
        rotate(m2, radians(180), &#123;0,1,0&#125;);
        rotate(m3, radians(270), &#123;0,1,0&#125;);
        index = 8;
    &#125;
    if(type == 3)&#123;// down majored
        rotate(m0, radians(-90), &#123;0,0,1&#125;);// roate align down axis
        m1 = m0;
        m2 = m0;
        m3 = m0;
        rotate(m1, radians(90), &#123;0,-1,0&#125;);// roate along the up xis
        rotate(m2, radians(180), &#123;0,-1,0&#125;);
        rotate(m3, radians(270), &#123;0,-1,0&#125;);
        index = 12;
    &#125;
    if(type == 4)&#123; //left majored
        rotate(m0, radians(-90), &#123;0,1,0&#125;);//left
        m1 = m0;
        m2 = m0;
        m3 = m0;
        rotate(m1, radians(90), &#123;0,0,1&#125;);
        rotate(m2, radians(180), &#123;0,0,1&#125;);
        rotate(m3, radians(270), &#123;0,0,1&#125;);
        index = 16;
    &#125;
    if(type == 5)&#123; //right majored
        rotate(m0, radians(90), &#123;0,1,0&#125;);//right
        m1 = m0;
        m2 = m0;
        m3 = m0;
        rotate(m1, radians(90), &#123;0,0,-1&#125;);
        rotate(m2, radians(180), &#123;0,0,-1&#125;);
        rotate(m3, radians(270), &#123;0,0,-1&#125;);
        index = 20;
    &#125;</code></pre>
<p>So eventually it will give us a giant variation map like this.</p>
<figure>
<a href="image-20230127031604812.png" title="more variations" class="gallery-item"><img src="image-20230127031604812.png" alt="more variations" /></a>
<figcaption aria-hidden="true">more variations</figcaption>
</figure>
<hr />
<h3 id="module-connectivity-encoding">Module Connectivity Encoding</h3>
<p>The purpose of encoding is for system to easily pick up the correct
module that satisfies the neighbor connectivity. I take this method to
encode the connectivity info.</p>
<p>Firstly, I take the "Normal axis" of geometry intersection of each
cubic face, to describe connectivity. Because, Normal is identical and
will rotate with the variations as we mentioned above. We can name
Normal axis has six different types, pointing towards "front",
"back","up","down","left", and "right" with corresponding digits, and if
there is no intersection of this cubic face, "0" will represent it.</p>
<p>So that, we could use 6 digit number from 0-6 to describe each faces
connectivity.</p>
<figure>
<a href="image-20230127031859950.png" title="Encoding Connectivity" class="gallery-item"><img src="image-20230127031859950.png" alt="Encoding Connectivity" /></a>
<figcaption aria-hidden="true">Encoding Connectivity</figcaption>
</figure>
<p>In Houdini, I implemented it in VEX, here's the encoder script.</p>
<pre class="c+"><code>function int[] connGen(vector vectorList[]; vector axisList[])&#123;
    //axisList store the normal axis of each faces intersection.
    //vectorList stores the normal of each faces.
    int conn[] = array(0,0,0,0,0,0);
    for(int i=0; i&lt;len(vectorList); i++)&#123;
        vector v = vectorList[i];
        vector a = axisList[i];
        int type = 0;
        
        if(a.x&gt;0.99)&#123;type = 1;&#125;//normal axis point to x+
        if(-a.x&gt;0.99)&#123;type = 2;&#125;//x-
        if(a.y&gt;0.99)&#123;type = 3;&#125;//y+
        if(-a.y&gt;0.99)&#123;type = 4;&#125;//y-
        if(a.z&gt;0.99)&#123;type = 5;&#125;//z+
        if(-a.z&gt;0.99)&#123;type = 6;&#125;//z-
        
        if(v.x&gt;0.99) &#123;conn[0]=type;&#125; //encode front face
        if(v.x&lt;-0.99) &#123;conn[1]=type;&#125;
        if(v.y&gt;0.99) &#123;conn[4]=type;&#125;
        if(v.y&lt;-0.99) &#123;conn[5]=type;&#125;
        if(v.z&gt;0.99) &#123;conn[2]=type;&#125;
        if(v.z&lt;-0.99) &#123;conn[3]=type;&#125;
    &#125;
    return conn;
&#125;</code></pre>
<p>And by applying each 24 variations with given type (majored axis), we
will get all the connectivity as shown:</p>
<figure>
<a href="image-20230128012206359.png" title="24 variants" class="gallery-item"><img src="image-20230128012206359.png" alt="24 variants" /></a>
<figcaption aria-hidden="true">24 variants</figcaption>
</figure>
<hr />
<h3 id="slot-inference">Slot Inference</h3>
<p>Finally, after all these preparation, we get to the most exciting
part, to generate the maze.</p>
<p>Firstly, we generate the point cloud and initiate neighbor's</p>
</div><script src="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/js/lightgallery.min.js"></script><script src="https://github.com/sachinchoolur/lg-thumbnail.js"></script><script src="https://github.com/sachinchoolur/lg-zoom.js"></script><script src="https://github.com/sachinchoolur/lg-autoplay.js"></script><script src="https://github.com/sachinchoolur/lg-fullscreen.js"></script><script src="https://github.com/sachinchoolur/lg-pager.js"></script><script src="https://github.com/sachinchoolur/lg-video.js"></script><script src="https://github.com/sachinchoolur/lg-hash.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script>
</div>


      </div>
      
  	</div>

    <!-- After footer scripts -->
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

  </body>
</html>
